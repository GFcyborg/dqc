/*
 * This file was generated by the Gradle 'init' task.
 * https://docs.gradle.org/9.2.1/userguide/building_java_projects.html in the Gradle documentation.
 * in order to build, run this command from project root-dir (where settings.gradle is), not the app sub-dir:
 * ./gradlew clean build test run
 */

plugins {
    id 'application'    // for building a CLI app in Java
    id 'antlr'
}

repositories { mavenCentral() }

dependencies {
    testImplementation libs.junit.jupiter
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
    implementation libs.guava   // This dependency is used by the application.
    antlr "org.antlr:antlr4:4.13.2"
    implementation "org.antlr:antlr4-runtime:4.13.2"
}

java { toolchain { languageVersion = JavaLanguageVersion.of(21) }}

application { mainClass = 'App'}

tasks.named('test') { useJUnitPlatform() }

sourceSets { main { java { srcDirs += "$buildDir/generated-src/antlr/main" }}}

tasks.generateGrammarSource { // Antlr package = (outputDirectory main-subdir) + (packageName)
    //outputDirectory = file("$buildDir/generated-src/antlr/main")
    arguments += [ "-listener", "-visitor" ]
    //packageName = "org.example"
}

tasks.compileJava { dependsOn tasks.generateGrammarSource }   //ensures *Lexer+Parser.java exist BEFORE App.java compiles

tasks.clean {
    delete "$buildDir/generated-src"
    delete "bin"
}
